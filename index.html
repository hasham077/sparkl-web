<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Join Sparkl, Book-Cleaning</title>
</head>
<body>
  <h2>Join Book Cleaning</h2>
  <p>If you have the app installed, it will open automatically. Otherwise, you will be redirected to download the app.</p>

  <script type="text/javascript">
    // Function to get query parameters from the URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

   const refCode = getQueryParam("ref");

    // Construct custom app scheme URL
    const appSchemeURL = refCode
      ? `sparkl://join/signup?ref=${refCode}`
      : "sparkl://join";

    const playStoreURL = "https://play.google.com/store/apps/details?id=com.geniai.family.friends.tracker.location";
    const appStoreURL = "https://apps.apple.com/pk/app/family-circle/id6478211890";

    // Attempt to open the app with or without the circle ID
    window.location.href = appSchemeURL;

    // Redirect to the app store after a short delay if the app is not installed
    setTimeout(() => {
      // Detect the platform and redirect to the appropriate store
      if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
        window.location.href = appStoreURL;
      } else {
        window.location.href = playStoreURL;
      }
    }, 1000); // Delay of 1 second (adjust if needed)
  </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Join Sparkl, Book-Cleaning</title>
  <script type="text/javascript">
    // Function to get query parameters from the URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    function redirectToApp() {
      const refCode = getQueryParam("ref");
      const appSchemeURL = refCode
        ? `sparkl://join/signup?ref=${refCode}`
        : "sparkl://join";

      const playStoreURL = "https://play.google.com/store/apps/details?id=com.geniai.family.friends.tracker.location";
      const appStoreURL = "https://apps.apple.com/pk/app/family-circle/id6478211890";

      // Detect Apple devices (iOS, iPadOS, macOS)
      const isAppleDevice = /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent) && !window.MSStream;

      if (isAppleDevice) {
        // For Apple devices, use iframe technique to avoid page unloading
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = appSchemeURL;
        document.body.appendChild(iframe);
        
        // Set timeout for fallback to App Store
        setTimeout(function() {
          window.location = appStoreURL;
        }, 500);
      } else {
        // For Android/other devices
        window.location.href = appSchemeURL;
        
        // Set timeout for fallback to Play Store
        setTimeout(function() {
          if (!document.hidden) {
            window.location.href = playStoreURL;
          }
        }, 1000);
      }
    }

    // Start the redirect process when page loads
    window.onload = redirectToApp;
  </script>
</head>
<body>
  <h2>Join Book Cleaning</h2>
  <p>If you have the app installed, it will open automatically. Otherwise, you will be redirected to download the app.</p>
</body>
</html>